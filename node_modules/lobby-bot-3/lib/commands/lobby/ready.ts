import { SlashSubcommand } from "discord-slash"
import { CommandInteraction, GuildMember } from "discord.js"
import { Channel, Lobby } from "../../lobbies"

export default new SlashSubcommand(
  "ready",
  "Mark yourself as ready",
  handle,
  cmd => cmd,
);

export async function handle(interaction: CommandInteraction) {
  const channel = interaction.channel as Channel;
  const lobby = await Lobby.get(channel);
  const wasReady = lobby.isReady();
  lobby.readyPlayers(interaction.member as GuildMember);
  const print = await lobby.print(
    channel,
    wasReady !== lobby.isReady() ? "The lobby is now ready!" : null,
    wasReady !== lobby.isReady() // Mention Players
  );
  await interaction.reply(print);
}
