"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const discord_slash_1 = require("discord-slash");
const lobbies_1 = require("../../lobbies");
const edit_1 = require("./edit");
exports.default = new discord_slash_1.SlashSubcommand("create", "Create a new lobby in a new thread", handle, edit_1.build);
async function handle(interaction) {
    var _a, _b, _c, _d, _e;
    await interaction.reply({ content: `Creating thread...`, ephemeral: true });
    const channel = (interaction.channel.isThread())
        ? interaction.channel.parent
        : interaction.channel;
    const name = (_a = interaction.options.getString('name')) !== null && _a !== void 0 ? _a : `${((_c = (_b = interaction.member) === null || _b === void 0 ? void 0 : _b.user) !== null && _c !== void 0 ? _c : interaction.user).username}'s Lobby`;
    const thread = await channel.threads.create({
        name,
        autoArchiveDuration: 1440,
        reason: `Game lobby`,
    });
    const lobby = await lobbies_1.Lobby.create(thread.id, name, (_d = interaction.options.getNumber('min')) !== null && _d !== void 0 ? _d : 2, interaction.options.getNumber('max'), (_e = (0, edit_1.parseTeams)(interaction.options.getString('teams'))) !== null && _e !== void 0 ? _e : []);
    await thread.members.add(interaction.user);
    await lobby.addPlayers(interaction.user);
    await thread.send(await lobby.print(thread));
}
//# sourceMappingURL=create.js.map